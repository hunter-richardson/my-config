#!/usr/bin/python3

import click
import os

def validate_dir(*dirs):
  try:
    for d in dirs:
      if os.path.isdir(d) and os.access(d, os.X_OK):
        continue
      else:
        raise ValueError
      
    return (*dirs)
  except ValueError:
    raise click.BadParameter('inputs must be a valid directory')

@click.command()
@click.option('dir', 'dirs', '--dir', '--dirs', callback=validate_dir, help='The directory to summarize.', prompt=True, multiple=True, type=click.STRING)
@click.option('quiet', 'silent', '--quiet', '--silent', help='Simply return without output', default=False, type=click.BOOL)
@click.argument('dir', 'quiet')
def count_files(*dir):
  """Recursively count the files in a directory, or name the file if there's only one"""
  files = []
  for d in dir:
    files = list.extend(os.walk(d, onerror=raise, topdown=False))
  
  if len(files) == 0:
    return 0
  elif len(files) == 1:
    if not quiet:
      print files[0]
    
    return files[0]
  else:
    if not quiet:
      print len(files)
    
    return len(files)
  


